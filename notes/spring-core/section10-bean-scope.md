# 섹션10. 빈 스코프 (Bean Scope)

## 빈 스코프란?
- 스프링 빈이 **언제 생성되고 언제까지 유지되는지**를 결정하는 범위
- 기본 스코프는 싱글톤
- 필요에 따라 생명주기를 다르게 설정 가능

## 스프링이 지원하는 스코프 종류
- singleton
- prototype
- request (웹)
- session (웹)
- application (웹)
- websocket (웹)

## 싱글톤 스코프 (Singleton Scope)
- 스프링 컨테이너당 **하나의 인스턴스만 생성**
- 컨테이너 시작 시 생성, 종료 시 소멸
- 기본 스코프

특징
- 메모리 효율적
- 상태를 가지면 안 됨 (무상태 설계 필수)

## 프로토타입 스코프 (Prototype Scope)
- 요청할 때마다 **새로운 빈 생성**
- 생성 후 의존관계 주입까지만 컨테이너가 관리
- 소멸 메서드 호출하지 않음

특징
- 매번 다른 객체가 필요할 때 사용
- 빈의 소멸 책임은 개발자에게 있음

## 싱글톤 vs 프로토타입
| 구분 | 싱글톤 | 프로토타입 |
|----|----|----|
| 생성 시점 | 컨테이너 시작 | 요청 시 |
| 인스턴스 수 | 1개 | 매번 새로 |
| 소멸 관리 | 스프링 | 개발자 |
| 사용 빈도 | 매우 높음 | 제한적 |

## 싱글톤 빈에서 프로토타입 빈 사용 문제
- 싱글톤은 생성 시점에 의존관계 주입
- 프로토타입 빈도 **한 번만 생성되어 고정됨**
- 기대한 “매번 새 인스턴스”가 아님

## 해결 방법
### ObjectProvider 사용
- 필요한 시점에 직접 조회
- 프로토타입 빈을 매번 새로 가져올 수 있음
- 실습 코드 👉 practice/spring/spring-core-basic/src/test/java/hello/core/section10_beanscope

## 웹 스코프 (Web Scope)
- 웹 환경에서만 사용 가능
- HTTP 요청/세션과 생명주기를 함께 함
- Spring MVC 기반 애플리케이션에서 사용

## request 스코프
- HTTP 요청 하나당 하나의 빈 생성
- 요청 종료 시 소멸

사용 예
- 요청별 로그 정보
- 요청 단위 데이터 저장

## session 스코프
- HTTP 세션 당 하나의 빈 생성
- 세션 종료 시 소멸

사용 예
- 로그인 사용자 정보
- 장바구니

## application 스코프
- 서블릿 컨테이너 단위로 하나 생성
- 애플리케이션 종료 시 소멸

특징
- 전역 공유 객체
- 실제 사용 빈도 낮음

## websocket 스코프
- 웹소켓 연결 단위로 빈 생성
- 웹소켓 세션 종료 시 소멸

## 웹 스코프의 핵심 문제
- 웹 스코프 빈은 **요청이 있어야 생성 가능**
- 싱글톤 빈 생성 시점에는 요청이 없음
- 바로 주입하면 오류 발생

## 해결 방법: 프록시 객체
- proxyMode 사용
- 가짜 프록시 객체를 먼저 주입
- 실제 요청 시점에 진짜 빈 연결

효과
- 싱글톤 빈에서도 웹 스코프 사용 가능
- 생성 시점 문제 해결

실습 코드 👉 practice/spring/spring-core-basic/src/main/java/hello/core/section10_beanscope

## 빈 스코프 설계 정리
- 기본은 싱글톤
- 상태가 필요하면 웹 스코프 고려
- 생명주기 충돌 시 프록시 또는 Provider 사용
- 스코프는 최소한으로 사용